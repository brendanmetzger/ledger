<section id="project" data-url="[$url]">
  
  <style type="text/css" media="screen">
    /* <![CDATA[ */
    body.editor > nav div {
      width: 25vw;
      overflow:hidden;
    }

    body.editor {
      padding: 0;
      border:none;
      overflow:hidden;
    }

    body.editor > main {
      padding: 0;
      margin-left: 25vw;
      width: 75vw;
    }
    
    #project {
      background-color:#fff;
      box-shadow:inset -0.25em 0 0.25em rgba(0,0,0,0.3);
      height: 100vh;
      overflow:auto;
    }
    #project fieldset {
      padding:2em 1em;
      min-height:100vh;
      box-sizing: border-box;
    }
    #project fieldset, #project legend {
      transition: background-color 0.5s;
    }
    #project fieldset:target, #project fieldset:target legend {
      background-color:rgba(200, 200, 200, 0.95);
      box-shadow: 0 0 0.25em rgba(0,0,0,0.1);
    }
    #project fieldset legend {
      font-size:2em;
      padding:1em;
    }
    #project fieldset textarea {
      box-shadow:0 0 0.25em rgba(0,0,0,0.2);
      width:calc(100% + 1em);
      height:40vh;
      margin:1em -0.5em;
      padding: 0.5em 0 0 1em;
      background-size: 1.5em 1.5em;
      background-position: left 0.175em;
      background-image: linear-gradient(transparent 95%, rgba(0, 0, 255, 0.1) 2.5%); 
    }
    
    #project dl {
      display:none;
    }
    .file legend {
      font-family: inconsolata;
    }
    /* ]]> */
  </style>

  
  
  <fieldset id="critique">
    <legend class="condensed">[$project:title Critique]</legend>
    <!-- iterate project:inputs -->
    <label class="container">
      <h5 class="condensed">[$key]</h5>
      <input type="range" name="project[@][axes][]" min="0" max="0.1" step="0.01" value="[$value]" style="width:100%"/>
    </label>
    <h5 class="centered percentage" style="margin:0.25em 0;font-weight:100;font-size:7.5em;">[$project:percentage]</h5>
  </fieldset>
  
  <!--  iterate project:files -->
  <fieldset id="[_$file:@hash]" class="file">
    <legend>[$file:@path]</legend>
    <dl>
      <dt>History</dt>
      <dd>???</dd>
      <dt><abbr title="source lines of code">SLOC</abbr></dt>
      <dd>[$file:@sloc]</dd>
      <dt>Errors</dt>
      <dd>iterate $report:errors</dd>
    </dl>
    <input type="hidden" name="[project[file][$index][@][errors]]" value="[$file:@errors]" />
    <input type="hidden" name="[project[file][$index][@][sloc]]" value="[$file:@sloc]" />
    <input type="hidden" name="[project[file][$index][@][length]]" value="[$file:@length]" />
    <input type="hidden" name="[project[file][$index][@][hash]]" value="[$file:@hash]"  />
    <input type="hidden" name="[project[file][$index][@][commits]]" value="[$file:@commits]" />
    <input type="hidden" name="[project[file][$index][@][age]]" value="[$file:@age]" />
    <input type="hidden" name="[project[file][$index][@][aux]]" value="[$file:@aux]" />
    <input type="hidden" name="[project[file][$index][@][report]]" value="[$file:@report]" />
    <input type="hidden" name="[project[file][$index][@][path]]" value="[$file:@path]" />
    <label for="notes">Notes</label>
    <textarea name="[project[file][$index][CDATA]]" class="lined">[$text]</textarea>
  </fieldset>
  <script type="text/javascript">
    // <![CDATA[
    bloc.embed('/javascript/iam.js');

    var ranges = Array.from(document.querySelectorAll('#project input[type="range"]'));
    document.querySelector('#project').addEventListener('input', function (evt) {
      var score = ranges.map(node => parseFloat(node.value, 10)).reduce((accumulator, current) => accumulator + current, 0);
      this.querySelector('.percentage').textContent = Math.max(0, Math.round(score * 100));
    });
    
    bloc.init('projects', function () {
      var tabs      = document.querySelectorAll('.inspector a[data-file]');
      var fieldsets = document.querySelectorAll('#project fieldset');
      var to = 0;
      var click = new MouseEvent('click', {
        bubbles: true,
        cancelable: true,
        view: window
      });
      
      var triggerClicks = function (position) {
        tabs[position].dispatchEvent(click);
      }
      scroll.monitor(document.querySelector('#project'), fieldsets.length, triggerClicks);
    });
    
    
    // ]]>
  </script>
</section>
